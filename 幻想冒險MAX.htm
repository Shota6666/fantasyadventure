<html lang="zh-TW"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>幻想冒險</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
            min-height: 100vh;
        }
        
        .game-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .btn {
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .item {
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .item:hover {
            transform: translateY(-2px);
        }
        
        .rarity-white {
            border-color: #f8fafc;
            background-color: rgba(248, 250, 252, 0.1);
        }
        
        .rarity-green {
            border-color: #4ade80;
            background-color: rgba(74, 222, 128, 0.1);
        }
        
        .rarity-blue {
            border-color: #60a5fa;
            background-color: rgba(96, 165, 250, 0.1);
        }
        
        .rarity-purple {
            border-color: #c084fc;
            background-color: rgba(192, 132, 252, 0.1);
        }
        
        .rarity-gold {
            border-color: #facc15;
            background-color: rgba(250, 204, 21, 0.1);
            animation: glow 2s infinite alternate;
        }
        
        @keyframes glow {
            from {
                box-shadow: 0 0 5px rgba(250, 204, 21, 0.5);
            }
            to {
                box-shadow: 0 0 15px rgba(250, 204, 21, 0.8);
            }
        }
        
        .critical {
            color: #ef4444;
            font-weight: bold;
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .monster-image {
            width: 100px;
            height: 100px;
            margin: 0 auto;
        }
        
        .progress-bar {
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            background-color: #334155;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #ef4444;
            transition: width 0.3s ease;
        }
        
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }
        
        .code-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .code-modal.active {
            opacity: 1;
            pointer-events: auto;
        }
        
        .code-content {
            background-color: #1e293b;
            width: 90%;
            max-width: 1000px;
            height: 80%;
            border-radius: 8px;
            padding: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .code-body {
            flex: 1;
            overflow-y: auto;
            background-color: #0f172a;
            border-radius: 4px;
            padding: 15px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        
        /* 新增菁英和首領怪物的發光效果 */
        .monster-elite {
            animation: eliteGlow 2s infinite alternate;
        }
        
        .monster-boss {
            animation: bossGlow 2s infinite alternate;
        }
        
        @keyframes eliteGlow {
            from {
                filter: drop-shadow(0 0 3px rgba(59, 130, 246, 0.5));
            }
            to {
                filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.9));
            }
        }
        
        @keyframes bossGlow {
            from {
                filter: drop-shadow(0 0 3px rgba(239, 68, 68, 0.5));
            }
            to {
                filter: drop-shadow(0 0 10px rgba(239, 68, 68, 0.9));
            }
        }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.16 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.col-span-full{grid-column:1 / -1}.mb-1{margin-bottom:0.25rem}.mb-2{margin-bottom:0.5rem}.mb-3{margin-bottom:0.75rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-32{height:8rem}.min-h-\[300px\]{min-height:300px}.grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-between{justify-content:space-between}.gap-2{gap:0.5rem}.gap-4{gap:1rem}.overflow-y-auto{overflow-y:auto}.rounded{border-radius:0.25rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.border{border-width:1px}.border-l{border-left-width:1px}.border-slate-600{--tw-border-opacity:1;border-color:rgb(71 85 105 / var(--tw-border-opacity, 1))}.border-slate-700{--tw-border-opacity:1;border-color:rgb(51 65 85 / var(--tw-border-opacity, 1))}.bg-amber-500{--tw-bg-opacity:1;background-color:rgb(245 158 11 / var(--tw-bg-opacity, 1))}.bg-amber-600{--tw-bg-opacity:1;background-color:rgb(217 119 6 / var(--tw-bg-opacity, 1))}.bg-slate-800{--tw-bg-opacity:1;background-color:rgb(30 41 59 / var(--tw-bg-opacity, 1))}.bg-slate-900{--tw-bg-opacity:1;background-color:rgb(15 23 42 / var(--tw-bg-opacity, 1))}.p-2{padding:0.5rem}.p-4{padding:1rem}.px-3{padding-left:0.75rem;padding-right:0.75rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-1{padding-top:0.25rem;padding-bottom:0.25rem}.py-10{padding-top:2.5rem;padding-bottom:2.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.pl-4{padding-left:1rem}.text-center{text-align:center}.text-2xl{font-size:1.5rem;line-height:2rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.text-amber-400{--tw-text-opacity:1;color:rgb(251 191 36 / var(--tw-text-opacity, 1))}.text-blue-400{--tw-text-opacity:1;color:rgb(96 165 250 / var(--tw-text-opacity, 1))}.text-slate-300{--tw-text-opacity:1;color:rgb(203 213 225 / var(--tw-text-opacity, 1))}.text-slate-400{--tw-text-opacity:1;color:rgb(148 163 184 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.hover\:bg-amber-600:hover{--tw-bg-opacity:1;background-color:rgb(217 119 6 / var(--tw-bg-opacity, 1))}.hover\:text-amber-300:hover{--tw-text-opacity:1;color:rgb(252 211 77 / var(--tw-text-opacity, 1))}.hover\:text-blue-300:hover{--tw-text-opacity:1;color:rgb(147 197 253 / var(--tw-text-opacity, 1))}.hover\:text-white:hover{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}</style><style data-id="immersive-translate-input-injected-css">.immersive-translate-input {
  position: absolute;
  top: 0;
  right: 0;
  left: 0;
  bottom: 0;
  z-index: 2147483647;
  display: flex;
  justify-content: center;
  align-items: center;
}
.immersive-translate-attach-loading::after {
  content: " ";

  --loading-color: #f78fb6;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  display: block;
  margin: 12px auto;
  position: relative;
  color: white;
  left: -100px;
  box-sizing: border-box;
  animation: immersiveTranslateShadowRolling 1.5s linear infinite;

  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-2000%, -50%);
  z-index: 100;
}

.immersive-translate-loading-spinner {
  vertical-align: middle !important;
  width: 10px !important;
  height: 10px !important;
  display: inline-block !important;
  margin: 0 4px !important;
  border: 2px rgba(221, 244, 255, 0.6) solid !important;
  border-top: 2px rgba(0, 0, 0, 0.375) solid !important;
  border-left: 2px rgba(0, 0, 0, 0.375) solid !important;
  border-radius: 50% !important;
  padding: 0 !important;
  -webkit-animation: immersive-translate-loading-animation 0.6s infinite linear !important;
  animation: immersive-translate-loading-animation 0.6s infinite linear !important;
}

@-webkit-keyframes immersive-translate-loading-animation {
  from {
    -webkit-transform: rotate(0deg);
  }

  to {
    -webkit-transform: rotate(359deg);
  }
}

@keyframes immersive-translate-loading-animation {
  from {
    transform: rotate(0deg);
  }

  to {
    transform: rotate(359deg);
  }
}

.immersive-translate-input-loading {
  --loading-color: #f78fb6;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  display: block;
  margin: 12px auto;
  position: relative;
  color: white;
  left: -100px;
  box-sizing: border-box;
  animation: immersiveTranslateShadowRolling 1.5s linear infinite;
}

@keyframes immersiveTranslateShadowRolling {
  0% {
    box-shadow: 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0),
      0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
  }

  12% {
    box-shadow: 100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0),
      0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
  }

  25% {
    box-shadow: 110px 0 var(--loading-color), 100px 0 var(--loading-color),
      0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
  }

  36% {
    box-shadow: 120px 0 var(--loading-color), 110px 0 var(--loading-color),
      100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0);
  }

  50% {
    box-shadow: 130px 0 var(--loading-color), 120px 0 var(--loading-color),
      110px 0 var(--loading-color), 100px 0 var(--loading-color);
  }

  62% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color),
      120px 0 var(--loading-color), 110px 0 var(--loading-color);
  }

  75% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
      130px 0 var(--loading-color), 120px 0 var(--loading-color);
  }

  87% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
      200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color);
  }

  100% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
      200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0);
  }
}

.immersive-translate-toast {
  display: flex;
  position: fixed;
  z-index: 2147483647;
  left: 0;
  right: 0;
  top: 1%;
  width: fit-content;
  padding: 12px 20px;
  margin: auto;
  overflow: auto;
  background: #fef6f9;
  box-shadow: 0px 4px 10px 0px rgba(0, 10, 30, 0.06);
  font-size: 15px;
  border-radius: 8px;
  color: #333;
}

.immersive-translate-toast-content {
  display: flex;
  flex-direction: row;
  align-items: center;
}

.immersive-translate-toast-hidden {
  margin: 0 20px 0 72px;
  text-decoration: underline;
  cursor: pointer;
}

.immersive-translate-toast-close {
  color: #666666;
  font-size: 20px;
  font-weight: bold;
  padding: 0 10px;
  cursor: pointer;
}

@media screen and (max-width: 768px) {
  .immersive-translate-toast {
    top: 0;
    padding: 12px 0px 0 10px;
  }
  .immersive-translate-toast-content {
    flex-direction: column;
    text-align: center;
  }
  .immersive-translate-toast-hidden {
    margin: 10px auto;
  }
}

.immersive-translate-modal {
  display: none;
  position: fixed;
  z-index: 2147483647;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgb(0, 0, 0);
  background-color: rgba(0, 0, 0, 0.4);
  font-size: 15px;
}

.immersive-translate-modal-content {
  background-color: #fefefe;
  margin: 10% auto;
  padding: 40px 24px 24px;
  border: 1px solid #888;
  border-radius: 10px;
  width: 80%;
  max-width: 270px;
  font-family: system-ui, -apple-system, "Segoe UI", "Roboto", "Ubuntu",
    "Cantarell", "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
    "Segoe UI Symbol", "Noto Color Emoji";
  position: relative;
}

@media screen and (max-width: 768px) {
  .immersive-translate-modal-content {
    margin: 50% auto !important;
  }
}

.immersive-translate-modal .immersive-translate-modal-content-in-input {
  max-width: 500px;
}
.immersive-translate-modal-content-in-input .immersive-translate-modal-body {
  text-align: left;
  max-height: unset;
}

.immersive-translate-modal-title {
  text-align: center;
  font-size: 16px;
  font-weight: 700;
  color: #333333;
}

.immersive-translate-modal-body {
  text-align: center;
  font-size: 14px;
  font-weight: 400;
  color: #333333;
  word-break: break-all;
  margin-top: 24px;
}

@media screen and (max-width: 768px) {
  .immersive-translate-modal-body {
    max-height: 250px;
    overflow-y: auto;
  }
}

.immersive-translate-close {
  color: #666666;
  position: absolute;
  right: 16px;
  top: 16px;
  font-size: 20px;
  font-weight: bold;
}

.immersive-translate-close:hover,
.immersive-translate-close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}

.immersive-translate-modal-footer {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  margin-top: 24px;
}

.immersive-translate-btn {
  width: fit-content;
  color: #fff;
  background-color: #ea4c89;
  border: none;
  font-size: 16px;
  margin: 0 8px;
  padding: 9px 30px;
  border-radius: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.immersive-translate-btn:hover {
  background-color: #f082ac;
}
.immersive-translate-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
.immersive-translate-btn:disabled:hover {
  background-color: #ea4c89;
}

.immersive-translate-cancel-btn {
  /* gray color */
  background-color: rgb(89, 107, 120);
}

.immersive-translate-cancel-btn:hover {
  background-color: hsl(205, 20%, 32%);
}

.immersive-translate-action-btn {
  background-color: transparent;
  color: #ea4c89;
  border: 1px solid #ea4c89;
}

.immersive-translate-btn svg {
  margin-right: 5px;
}

.immersive-translate-link {
  cursor: pointer;
  user-select: none;
  -webkit-user-drag: none;
  text-decoration: none;
  color: #007bff;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
}

.immersive-translate-primary-link {
  cursor: pointer;
  user-select: none;
  -webkit-user-drag: none;
  text-decoration: none;
  color: #ea4c89;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
}

.immersive-translate-modal input[type="radio"] {
  margin: 0 6px;
  cursor: pointer;
}

.immersive-translate-modal label {
  cursor: pointer;
}

.immersive-translate-close-action {
  position: absolute;
  top: 2px;
  right: 0px;
  cursor: pointer;
}

.imt-image-status {
  background-color: rgba(0, 0, 0, 0.5) !important;
  display: flex !important;
  flex-direction: column !important;
  align-items: center !important;
  justify-content: center !important;
  border-radius: 16px !important;
}
.imt-image-status img,
.imt-image-status svg,
.imt-img-loading {
  width: 28px !important;
  height: 28px !important;
  margin: 0 0 8px 0 !important;
  min-height: 28px !important;
  min-width: 28px !important;
  position: relative !important;
}
.imt-img-loading {
  background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAMAAACfWMssAAAAtFBMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////oK74hAAAAPHRSTlMABBMIDyQXHwyBfFdDMSw+OjXCb+5RG51IvV/k0rOqlGRM6KKMhdvNyZBz9MaupmxpWyj437iYd/yJVNZeuUC7AAACt0lEQVRIx53T2XKiUBCA4QYOiyCbiAsuuGBcYtxiYtT3f6/pbqoYHVFO5r+iivpo6DpAWYpqeoFfr9f90DsYAuRSWkFnPO50OgR9PwiCUFcl2GEcx+N/YBh6pvKaefHlUgZd1zVe0NbYcQjGBfzrPE8Xz8aF+71D8gG6DHFPpc4a7xFiCDuhaWgKgGIJQ3d5IMGDrpS4S5KgpIm+en9f6PlAhKby4JwEIxlYJV9h5k5nee9GoxHJ2IDSNB0dwdad1NAxDJ/uXDHYmebdk4PdbkS58CIVHdYSUHTYYRWOJblWSyu2lmy3KNFVJNBhxcuGW4YBVCbYGRZwIooipHsNqjM4FbgOQqQqSKQQU9V8xmi1QlgHqQQ6DDBvRUVCDirs+EzGDGOQTCATgtYTnbCVLgsVgRE0T1QE0qHCFAht2z6dLvJQs3Lo2FQoDxWNUiBhaP4eRgwNkI+dAjVOA/kUrIDwf3CG8NfNOE0eiFotSuo+rBiq8tD9oY4Qzc6YJw99hl1wzpQvD7ef2M8QgnOGJfJw+EltQc+oX2yn907QB22WZcvlUpd143dqQu+8pCJZuGE4xCuPXJqqcs5sNpsI93Rmzym1k4Npk+oD1SH3/a3LOK/JpUBpWfqNySxWzCfNCUITuDG5dtuphrUJ1myeIE9bIsPiKrfqTai5WZxbhtNphYx6GEIHihyGFTI69lje/rxajdh0s0msZ0zYxyPLhYCb1CyHm9Qsd2H37Y3lugVwL9kNh8Ot8cha6fUNQ8nuXi5z9/ExsAO4zQrb/ev1yrCB7lGyQzgYDGuxq1toDN/JGvN+HyWNHKB7zEoK+PX11e12G431erGYzwmytAWU56fkMHY5JJnDRR2eZji3AwtIcrEV8Cojat/BdQ7XOwGV1e1hDjGGjXbdArm8uJZtCH5MbcctVX8A1WpqumJHwckAAAAASUVORK5CYII=");
  background-size: 28px 28px;
  animation: image-loading-rotate 1s linear infinite !important;
}

.imt-image-status span {
  color: var(--bg-2, #fff) !important;
  font-size: 14px !important;
  line-height: 14px !important;
  font-weight: 500 !important;
  font-family: "PingFang SC", Arial, sans-serif !important;
}

@keyframes image-loading-rotate {
  from {
    transform: rotate(360deg);
  }
  to {
    transform: rotate(0deg);
  }
}
</style></head>
<body>
    <div class="game-container">
        <div class="text-center mb-6">
            <h1 class="text-4xl font-bold text-amber-400 mb-2">幻想冒險</h1>
            <p class="text-slate-300">踏上未知的旅程，探索神秘的世界</p>
        </div>
        
        <!-- 玩家狀態 -->
        <div id="player-stats" class="bg-slate-800 rounded-lg p-4 mb-6 shadow-lg">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">🧍‍♂️ 冒險者狀態</h2>
                <span class="bg-amber-600 text-white px-3 py-1 rounded-full text-sm">探索深度: <span id="depth">0</span></span>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <div class="flex justify-between mb-1">
                        <span>生命值</span>
                        <span id="hp-text">100/100</span>
                    </div>
                    <div class="progress-bar mb-3">
                        <div id="hp-bar" class="progress-fill" style="width: 100%;"></div>
                    </div>
                    
                    <div class="flex justify-between mb-1">
                        <span>攻擊力</span>
                        <span id="attack">5</span>
                    </div>
                    
                    <div class="flex justify-between">
                        <span>金幣</span>
                        <span id="gold">0</span>
                    </div>
                </div>
                
                <div class="border-l border-slate-600 pl-4">
                    <h3 class="font-medium mb-2">裝備</h3>
                    <div class="flex flex-col gap-2">
                        <div class="flex justify-between">
                            <span>武器</span>
                            <span id="weapon">無</span>
                        </div>
                        <div class="flex justify-between">
                            <span>防具</span>
                            <span id="armor">無</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 事件區域 -->
        <div id="event-area" class="bg-slate-800 rounded-lg p-4 mb-6 shadow-lg min-h-[300px]">
            <div class="text-center py-10">
                <h2 class="text-2xl font-bold mb-4">準備開始冒險</h2>
                <p class="mb-6 text-slate-300">點擊下方按鈕開始你的旅程</p>
                <button id="start-btn" class="btn bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-6 rounded-lg">
                    開始冒險
                </button>
            </div>
        </div>
        
        <!-- 背包 -->
        <div class="bg-slate-800 rounded-lg p-4 shadow-lg mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">🎒 背包 </h2>
                <div class="flex gap-2">
                    
                    <button id="toggle-inventory" class="text-amber-400 hover:text-amber-300">
                        顯示/隱藏
                    </button>
                </div>
            </div>
            
            <div id="inventory" class="hidden">
                <div id="inventory-items" class="inventory-grid">
                    <div class="text-center text-slate-400 col-span-full py-4">
                        背包是空的
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 遊戲日誌 -->
        <div class="bg-slate-800 rounded-lg p-4 shadow-lg mb-6">
            <div class="flex justify-between items-center mb-2">
                <h2 class="text-xl font-bold">📜 冒險日誌</h2>
                <button id="clear-log" class="text-amber-400 hover:text-amber-300 text-sm">
                    清空
                </button>
            </div>
            
            <div id="game-log" class="h-32 overflow-y-auto text-sm text-slate-300 border border-slate-700 rounded p-2 bg-slate-900">
                <div class="log-entry">歡迎來到幻想冒險！</div>
            </div>
        </div>
    </div>
    
    <!-- 程式碼查看模態框 -->
    <div id="code-modal" class="code-modal">
        <div class="code-content">
            <div class="code-header">
                <h2 class="text-xl font-bold">遊戲程式碼</h2>
                <button id="close-code-btn" class="text-slate-300 hover:text-white">
                    關閉
                </button>
            </div>
            <div id="code-body" class="code-body">
                <!-- 程式碼將在這裡顯示 -->
            </div>
        </div>
    </div>

    <script>
        // 遊戲狀態
        const gameState = {
            player: {
                maxHp: 100,
                hp: 100,
                attack: 5,
                gold: 0,
                depth: 0,
                equipment: {
                    weapon: null,
                    armor: null
                },
                inventory: []
            },
            currentEvent: null,
            currentMonster: null,
            inBattle: false,
            gameOver: false,
            merchantInventory: null // 儲存商人的商品列表
        };
        
        // 怪物資料庫
        const monsters = [
            { 
                id: 1, name: "史萊姆", hp: 15, attack: 3, 
                loot: [{ name: "史萊姆黏液", type: "material", rarity: "white", value: 10, chance: 0.4 }],
                eliteLoot: [{ name: "史萊姆精華", type: "material", rarity: "green", value: 20, chance: 0.15 }],
                bossLoot: [{ name: "史萊姆王冠", type: "material", rarity: "gold", value: 200, chance: 0.03 }],
                weight: 10,
                svg: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="60" r="40" fill="#88ddff" /><circle cx="35" cy="50" r="5" fill="black" /><circle cx="65" cy="50" r="5" fill="black" /><path d="M 30 70 Q 50 80 70 70" stroke="black" stroke-width="2" fill="none" /></svg>`
            },
            { 
                id: 2, name: "哥布林", hp: 25, attack: 5, 
                loot: [{ name: "哥布林耳朵", type: "material", rarity: "white", value: 20, chance: 0.3 }],
                eliteLoot: [{ name: "哥布林匕首", type: "weapon", rarity: "green", value: 30, attack: 3, chance: 0.15 }],
                bossLoot: [{ name: "哥布林酋長面具", type: "armor", rarity: "blue", value: 300, hp: 15, chance: 0.03 }],
                weight: 8,
                svg: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M 50 20 L 30 40 L 30 70 L 70 70 L 70 40 L 50 20" fill="#8eff8e" /><circle cx="35" cy="45" r="5" fill="black" /><circle cx="65" cy="45" r="5" fill="black" /><path d="M 40 60 L 60 60" stroke="black" stroke-width="2" fill="none" /><path d="M 25 35 L 35 30" stroke="#8eff8e" stroke-width="5" /><path d="M 75 35 L 65 30" stroke="#8eff8e" stroke-width="5" /></svg>`
            },
            { 
                id: 3, name: "骷髏戰士", hp: 30, attack: 7, 
                loot: [{ name: "骨頭碎片", type: "material", rarity: "white", value: 20, chance: 0.4 }],
                eliteLoot: [{ name: "骷髏劍", type: "weapon", rarity: "blue", value: 80, attack: 8, chance: 0.1 }],
                bossLoot: [{ name: "亡靈之盔", type: "armor", rarity: "purple", value: 350, hp: 25, chance: 0.02 }],
                weight: 7,
                svg: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="40" r="20" fill="#f0f0f0" /><circle cx="40" cy="35" r="5" fill="black" /><circle cx="60" cy="35" r="5" fill="black" /><path d="M 45 45 L 55 45" stroke="black" stroke-width="2" /><path d="M 40 60 L 40 90" stroke="#f0f0f0" stroke-width="8" /><path d="M 60 60 L 60 90" stroke="#f0f0f0" stroke-width="8" /><path d="M 30 60 L 70 60" stroke="#f0f0f0" stroke-width="8" /></svg>`
            },
            { 
                id: 4, name: "蜥蜴人", hp: 35, attack: 6, 
                loot: [{ name: "蜥蜴鱗片", type: "material", rarity: "green", value: 30, chance: 0.3 }],
                eliteLoot: [{ name: "蜥蜴人尾巴", type: "material", rarity: "blue", value: 80, chance: 0.1 }],
                bossLoot: [{ name: "蜥蜴王盾牌", type: "armor", rarity: "purple", value: 350, hp: 30, chance: 0.03 }],
                weight: 6,
                svg: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M 50 30 L 30 50 L 30 80 L 70 80 L 70 50 L 50 30" fill="#80ff80" /><circle cx="40" cy="45" r="5" fill="yellow" /><circle cx="60" cy="45" r="5" fill="yellow" /><path d="M 40 60 L 60 60" stroke="black" stroke-width="2" /><path d="M 70 60 Q 90 70 85 90" stroke="#80ff80" stroke-width="8" fill="none" /></svg>`
            },
            { 
                id: 5, name: "狼人", hp: 45, attack: 9, 
                loot: [{ name: "狼毛", type: "material", rarity: "white", value: 30, chance: 0.5 }],
                eliteLoot: [{ name: "狼人爪", type: "weapon", rarity: "blue", value: 120, attack: 10, chance: 0.1 }],
                bossLoot: [{ name: "狼王皮甲", type: "armor", rarity: "purple", value: 400, hp: 35, chance: 0.02 }],
                weight: 5,
                svg: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M 50 20 L 30 40 L 30 80 L 70 80 L 70 40 L 50 20" fill="#a0a0a0" /><circle cx="40" cy="40" r="5" fill="red" /><circle cx="60" cy="40" r="5" fill="red" /><path d="M 40 55 L 60 55" stroke="black" stroke-width="2" /><path d="M 30 20 L 40 30" stroke="#a0a0a0" stroke-width="8" /><path d="M 70 20 L 60 30" stroke="#a0a0a0" stroke-width="8" /></svg>`
            },
            { 
                id: 6, name: "食人魔", hp: 60, attack: 12, 
                loot: [{ name: "食人魔牙齒", type: "material", rarity: "blue", value: 80, chance: 0.2 }],
                eliteLoot: [{ name: "食人魔棍棒", type: "weapon", rarity: "blue", value: 150, attack: 15, chance: 0.15 }],
                bossLoot: [{ name: "食人魔王護甲", type: "armor", rarity: "gold", value: 700, hp: 50, chance: 0.01 }],
                weight: 4,
                svg: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M 50 20 L 25 40 L 25 80 L 75 80 L 75 40 L 50 20" fill="#c08040" /><circle cx="40" cy="45" r="6" fill="yellow" /><circle cx="60" cy="45" r="6" fill="yellow" /><path d="M 35 65 Q 50 75 65 65" stroke="black" stroke-width="3" fill="none" /><path d="M 30 30 L 40 35" stroke="#c08040" stroke-width="10" /><path d="M 70 30 L 60 35" stroke="#c08040" stroke-width="10" /></svg>`
            },
            { 
                id: 7, name: "幽靈", hp: 30, attack: 15, 
                loot: [{ name: "幽靈精華", type: "material", rarity: "blue", value: 50, chance: 0.4 }],
                eliteLoot: [{ name: "幽魂之刃", type: "weapon", rarity: "purple", value: 200, attack: 20, chance: 0.08 }],
                bossLoot: [{ name: "幽靈王冠", type: "armor", rarity: "gold", value: 650, hp: 40, chance: 0.01 }],
                weight: 3,
                svg: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M 30 30 Q 50 20 70 30 Q 80 50 70 70 Q 60 80 50 70 Q 40 80 30 70 Q 20 50 30 30" fill="#c0c0ff" fill-opacity="0.7" /><circle cx="40" cy="40" r="5" fill="black" /><circle cx="60" cy="40" r="5" fill="black" /><path d="M 40 55 Q 50 65 60 55" stroke="black" stroke-width="2" fill="none" /></svg>`
            },
            { 
                id: 8, name: "石像鬼", hp: 50, attack: 10, 
                loot: [{ name: "石像碎片", type: "material", rarity: "green", value: 70, chance: 0.3 }],
                eliteLoot: [{ name: "石像鬼翅膀", type: "material", rarity: "purple", value: 150, chance: 0.1 }],
                bossLoot: [{ name: "石像鬼王槍", type: "weapon", rarity: "gold", value: 650, attack: 30, chance: 0.01 }],
                weight: 3,
                svg: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M 50 30 L 30 50 L 30 70 L 70 70 L 70 50 L 50 30" fill="#808080" /><circle cx="40" cy="45" r="5" fill="red" /><circle cx="60" cy="45" r="5" fill="red" /><path d="M 40 60 L 60 60" stroke="black" stroke-width="2" /><path d="M 20 40 L 40 30" stroke="#808080" stroke-width="8" /><path d="M 80 40 L 60 30" stroke="#808080" stroke-width="8" /></svg>`
            },
            { 
                id: 9, name: "巨龍", hp: 80, attack: 18, 
                loot: [{ name: "龍鱗", type: "material", rarity: "purple", value: 100, chance: 0.25 }],
                eliteLoot: [{ name: "龍牙", type: "weapon", rarity: "purple", value: 300, attack: 25, chance: 0.1 }],
                bossLoot: [{ name: "龍王之心", type: "material", rarity: "gold", value: 800, chance: 0.02 }],
                weight: 2,
                svg: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M 50 20 L 20 40 L 20 70 L 80 70 L 80 40 L 50 20" fill="#ff4040" /><circle cx="35" cy="40" r="5" fill="yellow" /><circle cx="65" cy="40" r="5" fill="yellow" /><path d="M 40 55 L 60 55" stroke="black" stroke-width="3" /><path d="M 50 70 Q 60 90 80 95" stroke="#ff4040" stroke-width="10" fill="none" /><path d="M 20 30 L 30 20" stroke="#ff4040" stroke-width="5" /><path d="M 80 30 L 70 20" stroke="#ff4040" stroke-width="5" /></svg>`
            },
            { 
                id: 10, name: "死亡騎士", hp: 70, attack: 15, 
                loot: [{ name: "黑鐵碎片", type: "material", rarity: "blue", value: 90, chance: 0.3 }],
                eliteLoot: [{ name: "死亡騎士劍", type: "weapon", rarity: "purple", value: 250, attack: 22, chance: 0.12 }],
                bossLoot: [{ name: "死亡領主盔甲", type: "armor", rarity: "gold", value: 750, hp: 60, chance: 0.01 }],
                weight: 1,
                svg: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M 50 20 L 30 40 L 30 80 L 70 80 L 70 40 L 50 20" fill="#404040" /><circle cx="40" cy="40" r="5" fill="#ff0000" /><circle cx="60" cy="40" r="5" fill="#ff0000" /><rect x="40" y="60" width="20" height="5" fill="black" /><path d="M 50 80 L 50 90 L 70 90" stroke="#808080" stroke-width="5" fill="none" /></svg>`
            }
        ];
        
        // 裝備資料庫
        const equipment = {
            weapons: [
                { name: "木棒", rarity: "white", attack: 2, value: 15 },
                { name: "銅劍", rarity: "white", attack: 3, value: 25 },
                { name: "鐵劍", rarity: "green", attack: 5, value: 50 },
                { name: "鋼劍", rarity: "green", attack: 8, value: 75 },
                { name: "銀劍", rarity: "blue", attack: 12, value: 120 },
                { name: "魔法杖", rarity: "blue", attack: 15, value: 180 },
                { name: "符文劍", rarity: "purple", attack: 20, value: 250 },
                { name: "屠龍刀", rarity: "purple", attack: 25, value: 320 },
                { name: "神聖之劍", rarity: "gold", attack: 35, value: 550 },
                { name: "末日審判", rarity: "gold", attack: 50, value: 999 }
            ],
            armors: [
                { name: "布衣", rarity: "white", hp: 5, value: 20 },
                { name: "皮甲", rarity: "white", hp: 10, value: 30 },
                { name: "鎖甲", rarity: "green", hp: 15, value: 60 },
                { name: "鐵甲", rarity: "green", hp: 20, value: 80 },
                { name: "銀甲", rarity: "blue", hp: 30, value: 150 },
                { name: "魔法長袍", rarity: "blue", hp: 35, value: 200 },
                { name: "符文甲", rarity: "purple", hp: 45, value: 280 },
                { name: "龍鱗甲", rarity: "purple", hp: 55, value: 350 },
                { name: "神聖護甲", rarity: "gold", hp: 70, value: 500 },
                { name: "不朽之甲", rarity: "gold", hp: 100, value: 750 }
            ]
        };
        
        // 消耗品資料庫
        const consumables = [
            { name: "小型治療藥水", effect: "恢復20點生命值", value: 30, hp: 20 },
            { name: "中型治療藥水", effect: "恢復50點生命值", value: 75, hp: 50 },
            { name: "大型治療藥水", effect: "恢復100點生命值", value: 120, hp: 100 }
      ];
        
        // DOM 元素
        const elements = {
            eventArea: document.getElementById('event-area'),
            startBtn: document.getElementById('start-btn'),
            hpText: document.getElementById('hp-text'),
            hpBar: document.getElementById('hp-bar'),
            attack: document.getElementById('attack'),
            gold: document.getElementById('gold'),
            depth: document.getElementById('depth'),
            weapon: document.getElementById('weapon'),
            armor: document.getElementById('armor'),
            gameLog: document.getElementById('game-log'),
            inventory: document.getElementById('inventory'),
            inventoryItems: document.getElementById('inventory-items'),
            toggleInventory: document.getElementById('toggle-inventory'),
            clearLog: document.getElementById('clear-log'),
            viewCodeBtn: document.getElementById('view-code-btn'),
            codeModal: document.getElementById('code-modal'),
            closeCodeBtn: document.getElementById('close-code-btn'),
            codeBody: document.getElementById('code-body')
        };
        
        // 事件監聽器
        elements.startBtn.addEventListener('click', startNextEvent);
        elements.toggleInventory.addEventListener('click', toggleInventory);
        elements.clearLog.addEventListener('click', clearGameLog);
        elements.viewCodeBtn.addEventListener('click', showCodeModal);
        elements.closeCodeBtn.addEventListener('click', hideCodeModal);
        
        // 遊戲功能函數
        function startNextEvent() {
            if (gameState.gameOver) {
                resetGame();
                return;
            }
            
            gameState.player.depth++;
            updatePlayerStats();
            
            // 根據探索深度調整怪物出現機率
            let normalChance, eliteChance, bossChance;
            
            if (gameState.player.depth > 300) {
                // 深度 > 300: 一般10%, 精英50%, 首領40%
                normalChance = 0.1;
                eliteChance = 0.5;
                bossChance = 0.4;
            } else if (gameState.player.depth > 100) {
                // 深度 > 100: 一般40%, 精英50%, 首領10%
                normalChance = 0.4;
                eliteChance = 0.5;
                bossChance = 0.1;
            } else {
                // 深度 <= 100: 一般89%, 精英10%, 首領1%
                normalChance = 0.89;
                eliteChance = 0.1;
                bossChance = 0.01;
            }
            
            // 隨機選擇事件類型
            const eventRoll = Math.random();
            
            if (eventRoll < 0.7) {
                // 怪物戰鬥事件 (70% 機率)
                spawnMonster(normalChance, eliteChance, bossChance);
            } else if (eventRoll < 0.75) {
                // 修復事件 (5% 機率)
                healingEvent();
            } else if (eventRoll < 0.85) {
                // 商人事件 (10% 機率)
                // 每次遇到商人時重新生成商品
                generateMerchantInventory();
                merchantEvent();
            } else {
                // 寶箱事件 (15% 機率)
                treasureEvent();
            }
        }
        
        function spawnMonster(normalChance, eliteChance, bossChance) {
            // 根據權重選擇怪物
            const totalWeight = monsters.reduce((sum, monster) => sum + monster.weight, 0);
            let randomWeight = Math.random() * totalWeight;
            let selectedMonster = null;
            
            for (const monster of monsters) {
                randomWeight -= monster.weight;
                if (randomWeight <= 0) {
                    selectedMonster = {...monster};
                    break;
                }
            }
            
            if (!selectedMonster) {
                selectedMonster = {...monsters[0]};
            }
            
            // 決定是否為菁英或首領
            const roll = Math.random();
            let monsterType = "normal";
            
            if (roll < bossChance) {
                // 首領 - 修改為血量*3，攻擊力*3
                selectedMonster.hp = Math.floor(selectedMonster.hp * 3);
                selectedMonster.attack = Math.floor(selectedMonster.attack * 3);
                selectedMonster.name = "首領" + selectedMonster.name;
                monsterType = "boss";
            } else if (roll < eliteChance + bossChance) {
                // 菁英
                selectedMonster.hp = Math.floor(selectedMonster.hp * 2);
                selectedMonster.attack = Math.floor(selectedMonster.attack * 1.5);
                selectedMonster.name = "菁英" + selectedMonster.name;
                monsterType = "elite";
            }
            
            gameState.currentMonster = {
                ...selectedMonster,
                currentHp: selectedMonster.hp,
                type: monsterType
            };
            
            gameState.inBattle = true;
            
            renderBattleScreen();
            addToLog(`遭遇了 ${selectedMonster.name}！`);
        }
        
        function renderBattleScreen() {
            const monster = gameState.currentMonster;
            
            // 根據怪物類型添加發光效果的CSS類別
            let monsterClass = "";
            if (monster.type === "elite") {
                monsterClass = "monster-elite";
            } else if (monster.type === "boss") {
                monsterClass = "monster-boss";
            }
            
            elements.eventArea.innerHTML = `
                <div class="text-center mb-6 fade-in">
                    <h2 class="text-2xl font-bold mb-4">戰鬥！</h2>
                    <div class="monster-image mb-4 ${monsterClass}">
                        ${monster.svg}
                    </div>
                    <p class="text-xl font-bold text-amber-400">${monster.name}</p>
                    <div class="mt-2">
                        <div class="flex justify-center items-center mb-1">
                            <span class="mr-2">HP:</span>
                            <span>${monster.currentHp}/${monster.hp}</span>
                        </div>
                        <div class="progress-bar w-1/2 mx-auto mb-3">
                            <div class="progress-fill" style="width: ${(monster.currentHp / monster.hp) * 100}%;"></div>
                        </div>
                        <p>攻擊力: ${monster.attack}</p>
                    </div>
                </div>
                
                <div class="flex justify-center gap-4">
                    <button id="fight-btn" class="btn bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-lg">
                        戰鬥
                    </button>
                    <button id="flee-btn" class="btn bg-slate-600 hover:bg-slate-700 text-white font-bold py-2 px-6 rounded-lg">
                        逃跑
                    </button>
                </div>
            `;
            
            document.getElementById('fight-btn').addEventListener('click', fightMonster);
            document.getElementById('flee-btn').addEventListener('click', tryToFlee);
        }
        
        function fightMonster() {
            if (!gameState.inBattle || !gameState.currentMonster) return;
            
            const monster = gameState.currentMonster;
            const player = gameState.player;
            
            // 玩家攻擊
            let playerDamage = player.attack;
            let criticalHit = Math.random() < 0.05; // 5% 致命一擊機率
            
            if (criticalHit) {
                playerDamage *= 2;
                addToLog(`你對 ${monster.name} 造成了 <span class="critical">${playerDamage}</span> 點致命傷害！`);
            } else {
                addToLog(`你對 ${monster.name} 造成了 ${playerDamage} 點傷害。`);
            }
            
            monster.currentHp -= playerDamage;
            
            // 檢查怪物是否死亡
            if (monster.currentHp <= 0) {
                monsterDefeated();
                return;
            }
            
            // 怪物攻擊
            let monsterDamage = monster.attack;
            let monsterCrit = Math.random() < 0.1; // 10% 致命一擊機率
            
            if (monsterCrit) {
                monsterDamage *= 2;
                addToLog(`${monster.name} 對你造成了 <span class="critical">${monsterDamage}</span> 點致命傷害！`);
            } else {
                addToLog(`${monster.name} 對你造成了 ${monsterDamage} 點傷害。`);
            }
            
            player.hp -= monsterDamage;
            
            // 檢查玩家是否死亡
            if (player.hp <= 0) {
                playerDied();
                return;
            }
            
            // 更新戰鬥畫面
            updatePlayerStats();
            renderBattleScreen();
        }
        
        function tryToFlee() {
            if (!gameState.inBattle) return;
            
            if (Math.random() < 0.5) {
                // 逃跑成功
                addToLog(`你成功地從 ${gameState.currentMonster.name} 身邊逃脫了！`);
                gameState.inBattle = false;
                gameState.currentMonster = null;
                
                elements.eventArea.innerHTML = `
                    <div class="text-center py-10 fade-in">
                        <h2 class="text-2xl font-bold mb-4">逃跑成功</h2>
                        <p class="mb-6 text-slate-300">你成功地逃離了戰鬥</p>
                        <button id="continue-btn" class="btn bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-6 rounded-lg">
                            繼續冒險
                        </button>
                    </div>
                `;
                
                document.getElementById('continue-btn').addEventListener('click', startNextEvent);
            } else {
                // 逃跑失敗
                const damage = gameState.currentMonster.attack;
                gameState.player.hp -= damage;
                
                addToLog(`逃跑失敗！${gameState.currentMonster.name} 對你造成了 ${damage} 點傷害。`);
                
                // 檢查玩家是否死亡
                if (gameState.player.hp <= 0) {
                    playerDied();
                    return;
                }
                
                updatePlayerStats();
                renderBattleScreen();
            }
        }
        
        function monsterDefeated() {
            const monster = gameState.currentMonster;
            gameState.inBattle = false;
            
            addToLog(`你擊敗了 ${monster.name}！`);
            
            // 獲得戰利品
            const loot = [];
            
            // 基本戰利品
            monster.loot.forEach(item => {
                if (Math.random() < item.chance) {
                    loot.push({...item});
                }
            });
            
            // 菁英或首領戰利品
            if (monster.type === "elite" || monster.type === "boss") {
                monster.eliteLoot.forEach(item => {
                    if (Math.random() < item.chance) {
                        loot.push({...item});
                    }
                });
            }
            
            // 首領特殊戰利品
            if (monster.type === "boss") {
                monster.bossLoot.forEach(item => {
                    if (Math.random() < item.chance) {
                        loot.push({...item});
                    }
                });
            }
            
            // 隨機金幣獎勵 (進一步減少金幣掉落量)
            const goldReward = Math.floor(Math.random() * (monster.hp / 4)) + 2;
            gameState.player.gold += goldReward;
            
            // 顯示戰利品畫面
            elements.eventArea.innerHTML = `
                <div class="text-center py-6 fade-in">
                    <h2 class="text-2xl font-bold mb-2">戰鬥勝利！</h2>
                    <p class="mb-4 text-slate-300">你擊敗了 ${monster.name}</p>
                    
                    <div class="mb-4">
                        <p class="text-amber-400">獲得 ${goldReward} 金幣</p>
                    </div>
                    
                    ${loot.length > 0 ? `
                        <div class="mb-6">
                            <h3 class="font-bold mb-2">獲得戰利品：</h3>
                            <div class="flex flex-wrap justify-center gap-2">
                                ${loot.map(item => `
                                    <div class="item rarity-${item.rarity} p-2 rounded-lg text-center">
                                        <p class="font-bold">${item.name}</p>
                                        <p class="text-sm">${item.value} 金幣</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : `
                        <p class="mb-6 text-slate-400">沒有獲得任何戰利品</p>
                    `}
                    
                    <button id="continue-btn" class="btn bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-6 rounded-lg">
                        繼續冒險
                    </button>
                </div>
            `;
            
            // 將戰利品加入背包
            loot.forEach(item => {
                gameState.player.inventory.push(item);
                addToLog(`獲得了 ${item.name}！`);
            });
            
            updatePlayerStats();
            document.getElementById('continue-btn').addEventListener('click', startNextEvent);
        }
        
        function healingEvent() {
            const healAmount = 20;
            const oldHp = gameState.player.hp;
            
            gameState.player.hp = Math.min(gameState.player.maxHp, gameState.player.hp + healAmount);
            const actualHeal = gameState.player.hp - oldHp;
            
            elements.eventArea.innerHTML = `
                <div class="text-center py-10 fade-in">
                    <h2 class="text-2xl font-bold mb-4">發現治療泉水</h2>
                    <p class="mb-2 text-slate-300">你發現了一處神奇的泉水，喝了一口感覺精神煥發！</p>
                    <p class="text-green-400 mb-6">恢復了 ${actualHeal} 點生命值</p>
                    <button id="continue-btn" class="btn bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-6 rounded-lg">
                        繼續冒險
                    </button>
                </div>
            `;
            
            addToLog(`發現治療泉水，恢復了 ${actualHeal} 點生命值！`);
            updatePlayerStats();
            
            document.getElementById('continue-btn').addEventListener('click', startNextEvent);
        }
        
        // 生成商人商品
        function generateMerchantInventory() {
            // 只有在商人商品為空或者是新的商人時才生成新商品
            if (gameState.merchantInventory === null) {
                const merchantItems = [];
                
                // 隨機選擇 4 個商品
                const allItems = [
                    ...equipment.weapons,
                    ...equipment.armors,
                    ...consumables
                ];
                
                // 根據稀有度排序
                const rarityOrder = { "white": 0, "green": 1, "blue": 2, "purple": 3, "gold": 4 };
                
                // 隨機選擇商品，但稀有度越高越少見
                for (let i = 0; i < 4; i++) {
                    const rarityRoll = Math.random();
                    let targetRarity;
                    
                    if (rarityRoll < 0.4) targetRarity = "white";
                    else if (rarityRoll < 0.7) targetRarity = "green";
                    else if (rarityRoll < 0.9) targetRarity = "blue";
                    else if (rarityRoll < 0.98) targetRarity = "purple";
                    else targetRarity = "gold";
                    
                    // 過濾符合稀有度的物品
                    const eligibleItems = allItems.filter(item => 
                        item.rarity === targetRarity || !item.rarity
                    );
                    
                    if (eligibleItems.length > 0) {
                        const randomItem = eligibleItems[Math.floor(Math.random() * eligibleItems.length)];
                        merchantItems.push({...randomItem});
                    } else {
                        // 如果沒有符合稀有度的物品，就選擇一般物品
                        const randomItem = allItems.filter(item => item.rarity === "white" || !item.rarity);
                        if (randomItem.length > 0) {
                            merchantItems.push({...randomItem[Math.floor(Math.random() * randomItem.length)]});
                        }
                    }
                }
                
                gameState.merchantInventory = merchantItems;
            }
        }
        
        function merchantEvent() {
            const merchantItems = gameState.merchantInventory;
            
            elements.eventArea.innerHTML = `
                <div class="py-6 fade-in">
                    <h2 class="text-2xl font-bold mb-4 text-center">遇到商人</h2>
                    <p class="mb-6 text-slate-300 text-center">一位神秘的商人向你展示了他的商品</p>
                    
                    <div class="mb-6">
                        <h3 class="font-bold mb-2 text-center">商品列表：</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${merchantItems.map((item, index) => `
                                <div class="item ${item.rarity ? 'rarity-' + item.rarity : ''} p-3 rounded-lg">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="font-bold">${item.name}</p>
                                            ${item.attack ? `<p class="text-sm">攻擊力 +${item.attack}</p>` : ''}
                                            ${item.hp ? `<p class="text-sm">生命值 +${item.hp}</p>` : ''}
                                            ${item.effect ? `<p class="text-sm">${item.effect}</p>` : ''}
                                        </div>
                                        <div class="text-right">
                                            <p class="text-amber-400">${item.value} 金幣</p>
                                            <button class="buy-btn mt-2 bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-lg text-sm" 
                                                data-index="${index}" ${gameState.player.gold < item.value ? 'disabled' : ''}>
                                                ${gameState.player.gold < item.value ? '金幣不足' : '購買'}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h3 class="font-bold mb-2 text-center">出售物品：</h3>
                        <button id="sell-btn" class="block mx-auto bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded-lg">
                            出售物品
                        </button>
                    </div>
                    
                    <div class="text-center">
                        <button id="leave-btn" class="btn bg-slate-600 hover:bg-slate-700 text-white font-bold py-2 px-6 rounded-lg">
                            離開商人
                        </button>
                    </div>
                </div>
            `;
            
            // 添加購買事件
            document.querySelectorAll('.buy-btn').forEach(btn => {
                if (!btn.disabled) {
                    btn.addEventListener('click', () => {
                        const index = parseInt(btn.getAttribute('data-index'));
                        buyItem(index);
                    });
                }
            });
            
            // 添加出售事件
            document.getElementById('sell-btn').addEventListener('click', () => {
                showSellMenu();
            });
            
            // 添加離開事件
            document.getElementById('leave-btn').addEventListener('click', () => {
                // 離開商人時清空商人商品，下次遇到商人時重新生成
                gameState.merchantInventory = null;
                startNextEvent();
            });
            
            addToLog(`你遇到了一位商人。`);
        }
        
        function buyItem(index) {
            const item = gameState.merchantInventory[index];
            
            if (gameState.player.gold < item.value) {
                addToLog(`你沒有足夠的金幣購買 ${item.name}。`);
                return;
            }
            
            gameState.player.gold -= item.value;
            
            if (item.attack) {
                // 武器
                gameState.player.inventory.push({...item, type: "weapon"});
                addToLog(`你購買了 ${item.name}。`);
            } else if (item.hp && !item.effect) {
                // 防具
                gameState.player.inventory.push({...item, type: "armor"});
                addToLog(`你購買了 ${item.name}。`);
            } else {
                // 消耗品
                gameState.player.inventory.push({...item, type: "consumable"});
                addToLog(`你購買了 ${item.name}。`);
            }
            
            // 從商人庫存中移除已購買的物品
            gameState.merchantInventory.splice(index, 1);
            
            updatePlayerStats();
            merchantEvent(); // 重新渲染商人畫面，但保持相同的商品
        }
        
        function showSellMenu() {
            // 檢查背包是否為空
            if (gameState.player.inventory.length === 0) {
                addToLog("你的背包是空的，沒有東西可以賣。");
                return;
            }
            
            elements.eventArea.innerHTML = `
                <div class="py-6 fade-in">
                    <h2 class="text-2xl font-bold mb-4 text-center">出售物品</h2>
                    <p class="mb-6 text-slate-300 text-center">選擇要出售的物品</p>
                    
                    <div class="mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${gameState.player.inventory.map((item, index) => `
                                <div class="item ${item.rarity ? 'rarity-' + item.rarity : ''} p-3 rounded-lg">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <p class="font-bold">${item.name}</p>
                                            ${item.attack ? `<p class="text-sm">攻擊力 +${item.attack}</p>` : ''}
                                            ${item.hp && !item.effect ? `<p class="text-sm">生命值 +${item.hp}</p>` : ''}
                                            ${item.effect ? `<p class="text-sm">${item.effect}</p>` : ''}
                                        </div>
                                        <div class="text-right">
                                            <p class="text-amber-400">${Math.floor(item.value / 2)} 金幣</p>
                                            <button class="sell-btn mt-2 bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-lg text-sm" 
                                                data-index="${index}">
                                                出售
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <button id="back-btn" class="btn bg-slate-600 hover:bg-slate-700 text-white font-bold py-2 px-6 rounded-lg">
                            返回
                        </button>
                    </div>
                </div>
            `;
            
            // 添加出售事件
            document.querySelectorAll('.sell-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const index = parseInt(btn.getAttribute('data-index'));
                    sellItem(index);
                });
            });
            
            // 添加返回事件
            document.getElementById('back-btn').addEventListener('click', () => {
                // 返回商人畫面，但不重新生成商品
                merchantEvent();
            });
        }
        
        function sellItem(index) {
            const item = gameState.player.inventory[index];
            const sellPrice = Math.floor(item.value / 2);
            
            gameState.player.gold += sellPrice;
            gameState.player.inventory.splice(index, 1);
            
            addToLog(`你出售了 ${item.name}，獲得 ${sellPrice} 金幣。`);
            updatePlayerStats();
            
            // 檢查背包是否為空，如果為空則返回商人畫面
            if (gameState.player.inventory.length === 0) {
                addToLog("背包已空，返回商人畫面。");
                merchantEvent();
            } else {
                // 否則重新渲染出售畫面
                showSellMenu();
            }
        }
        
        function treasureEvent() {
            const treasureTypes = [
                { type: "gold", chance: 0.4 },
                { type: "equipment", chance: 0.3 },
                { type: "consumable", chance: 0.2 },
                { type: "empty", chance: 0.05 },
                { type: "trap", chance: 0.05 }
            ];
            
            let totalChance = 0;
            for (const type of treasureTypes) {
                totalChance += type.chance;
            }
            
            const roll = Math.random() * totalChance;
            let accumulatedChance = 0;
            let selectedType = treasureTypes[0].type;
            
            for (const type of treasureTypes) {
                accumulatedChance += type.chance;
                if (roll <= accumulatedChance) {
                    selectedType = type.type;
                    break;
                }
            }
            
            elements.eventArea.innerHTML = `
                <div class="text-center py-10 fade-in">
                    <h2 class="text-2xl font-bold mb-4">發現寶箱</h2>
                    <p class="mb-6 text-slate-300">你發現了一個神秘的寶箱</p>
                    <button id="open-btn" class="btn bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-6 rounded-lg">
                        打開寶箱
                    </button>
                </div>
            `;
            
            document.getElementById('open-btn').addEventListener('click', () => {
                openTreasure(selectedType);
            });
            
            addToLog(`你發現了一個寶箱。`);
        }
        
        function openTreasure(type) {
            let content = '';
            
            switch (type) {
                case "gold":
                    const goldAmount = Math.floor(Math.random() * 50) + 10;
                    gameState.player.gold += goldAmount;
                    
                    content = `
                        <h2 class="text-2xl font-bold mb-4">金幣寶箱</h2>
                        <p class="mb-2 text-slate-300">寶箱裡裝滿了閃閃發光的金幣！</p>
                        <p class="text-amber-400 mb-6">獲得 ${goldAmount} 金幣</p>
                    `;
                    
                    addToLog(`你從寶箱中獲得了 ${goldAmount} 金幣。`);
                    break;
                    
                case "equipment":
                    // 隨機選擇武器或防具
                    const isWeapon = Math.random() < 0.5;
                    const rarityRoll = Math.random();
                    let rarity;
                    
                    if (rarityRoll < 0.5) rarity = "white";
                    else if (rarityRoll < 0.8) rarity = "green";
                    else if (rarityRoll < 0.95) rarity = "blue";
                    else if (rarityRoll < 0.99) rarity = "purple";
                    else rarity = "gold";
                    
                    const equipmentList = isWeapon ? equipment.weapons : equipment.armors;
                    const eligibleEquipment = equipmentList.filter(item => item.rarity === rarity);
                    
                    if (eligibleEquipment.length > 0) {
                        const randomEquipment = {...eligibleEquipment[Math.floor(Math.random() * eligibleEquipment.length)]};
                        randomEquipment.type = isWeapon ? "weapon" : "armor";
                        
                        gameState.player.inventory.push(randomEquipment);
                        
                        content = `
                            <h2 class="text-2xl font-bold mb-4">裝備寶箱</h2>
                            <p class="mb-2 text-slate-300">寶箱裡有一件閃閃發光的裝備！</p>
                            <div class="item rarity-${randomEquipment.rarity} p-3 rounded-lg inline-block mb-6">
                                <p class="font-bold">${randomEquipment.name}</p>
                                ${isWeapon ? `<p>攻擊力 +${randomEquipment.attack}</p>` : `<p>生命值 +${randomEquipment.hp}</p>`}
                            </div>
                        `;
                        
                        addToLog(`你從寶箱中獲得了 ${randomEquipment.name}。`);
                    } else {
                        // 如果沒有符合稀有度的裝備，給予金幣
                        const goldAmount = Math.floor(Math.random() * 30) + 10;
                        gameState.player.gold += goldAmount;
                        
                        content = `
                            <h2 class="text-2xl font-bold mb-4">金幣寶箱</h2>
                            <p class="mb-2 text-slate-300">寶箱裡裝滿了閃閃發光的金幣！</p>
                            <p class="text-amber-400 mb-6">獲得 ${goldAmount} 金幣</p>
                        `;
                        
                        addToLog(`你從寶箱中獲得了 ${goldAmount} 金幣。`);
                    }
                    break;
                    
                case "consumable":
                    const randomConsumable = {...consumables[Math.floor(Math.random() * consumables.length)]};
                    randomConsumable.type = "consumable";
                    
                    gameState.player.inventory.push(randomConsumable);
                    
                    content = `
                        <h2 class="text-2xl font-bold mb-4">藥水寶箱</h2>
                        <p class="mb-2 text-slate-300">寶箱裡有一瓶閃閃發光的藥水！</p>
                        <div class="p-3 rounded-lg inline-block mb-6 bg-green-900 border border-green-500">
                            <p class="font-bold">${randomConsumable.name}</p>
                            <p>${randomConsumable.effect}</p>
                        </div>
                    `;
                    
                    addToLog(`你從寶箱中獲得了 ${randomConsumable.name}。`);
                    break;
                    
                case "empty":
                    content = `
                        <h2 class="text-2xl font-bold mb-4">空寶箱</h2>
                        <p class="mb-6 text-slate-300">寶箱是空的...看來有人比你先到這裡了。</p>
                    `;
                    
                    addToLog(`你打開了寶箱，但裡面什麼都沒有。`);
                    break;
                    
                case "trap":
                    const trapDamage = Math.floor(Math.random() * 15) + 5;
                    gameState.player.hp -= trapDamage;
                    
                    content = `
                        <h2 class="text-2xl font-bold mb-4">陷阱寶箱</h2>
                        <p class="mb-2 text-slate-300">當你打開寶箱時，一個機關觸發了！</p>
                        <p class="text-red-500 mb-6">你受到了 ${trapDamage} 點傷害</p>
                    `;
                    
                    addToLog(`你打開寶箱時觸發了陷阱，受到 ${trapDamage} 點傷害。`);
                    
                    // 檢查玩家是否死亡
                    if (gameState.player.hp <= 0) {
                        playerDied();
                        return;
                    }
                    break;
            }
            
            elements.eventArea.innerHTML = `
                <div class="text-center py-10 fade-in">
                    ${content}
                    <button id="continue-btn" class="btn bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-6 rounded-lg">
                        繼續冒險
                    </button>
                </div>
            `;
            
            updatePlayerStats();
            document.getElementById('continue-btn').addEventListener('click', startNextEvent);
        }
        
        function playerDied() {
            gameState.gameOver = true;
            
            elements.eventArea.innerHTML = `
                <div class="text-center py-10 fade-in">
                    <h2 class="text-3xl font-bold mb-4 text-red-500">你死了！</h2>
                    <p class="mb-2 text-slate-300">你的冒險到此結束...</p>
                    <p class="mb-6">探索深度: ${gameState.player.depth}</p>
                    <button id="restart-btn" class="btn bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-6 rounded-lg">
                        重新開始冒險
                    </button>
                </div>
            `;
            
            addToLog(`你死了！探索深度: ${gameState.player.depth}`);
            document.getElementById('restart-btn').addEventListener('click', resetGame);
        }
        
        function resetGame() {
            gameState.player = {
                maxHp: 100,
                hp: 100,
                attack: 5,
                gold: 0,
                depth: 0,
                equipment: {
                    weapon: null,
                    armor: null
                },
                inventory: []
            };
            
            gameState.currentEvent = null;
            gameState.currentMonster = null;
            gameState.inBattle = false;
            gameState.gameOver = false;
            gameState.merchantInventory = null;
            
            updatePlayerStats();
            
            elements.eventArea.innerHTML = `
                <div class="text-center py-10">
                    <h2 class="text-2xl font-bold mb-4">準備開始冒險</h2>
                    <p class="mb-6 text-slate-300">點擊下方按鈕開始你的旅程</p>
                    <button id="start-btn" class="btn bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-6 rounded-lg">
                        開始冒險
                    </button>
                </div>
            `;
            
            addToLog(`開始新的冒險！`);
            document.getElementById('start-btn').addEventListener('click', startNextEvent);
        }
        
        function updatePlayerStats() {
            const player = gameState.player;
            
            elements.hpText.textContent = `${player.hp}/${player.maxHp}`;
            elements.hpBar.style.width = `${(player.hp / player.maxHp) * 100}%`;
            elements.attack.textContent = player.attack;
            elements.gold.textContent = player.gold;
            elements.depth.textContent = player.depth;
            
            elements.weapon.textContent = player.equipment.weapon ? player.equipment.weapon.name : "無";
            elements.armor.textContent = player.equipment.armor ? player.equipment.armor.name : "無";
            
            renderInventory();
        }
        
        function renderInventory() {
            if (gameState.player.inventory.length === 0) {
                elements.inventoryItems.innerHTML = `
                    <div class="text-center text-slate-400 col-span-full py-4">
                        背包是空的
                    </div>
                `;
                return;
            }
            
            elements.inventoryItems.innerHTML = gameState.player.inventory.map((item, index) => `
                <div class="item ${item.rarity ? 'rarity-' + item.rarity : ''} p-2 rounded-lg">
                    <p class="font-bold">${item.name}</p>
                    ${item.attack ? `<p class="text-sm">攻擊力 +${item.attack}</p>` : ''}
                    ${item.hp && !item.effect ? `<p class="text-sm">生命值 +${item.hp}</p>` : ''}
                    ${item.effect ? `<p class="text-sm">${item.effect}</p>` : ''}
                    <div class="flex justify-between mt-2">
                        <span class="text-amber-400 text-sm">${item.value} 金幣</span>
                        ${item.type === "weapon" ? `
                            <button class="equip-btn bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded text-xs" data-index="${index}" data-type="weapon">
                                裝備
                            </button>
                        ` : item.type === "armor" ? `
                            <button class="equip-btn bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded text-xs" data-index="${index}" data-type="armor">
                                裝備
                            </button>
                        ` : item.type === "consumable" ? `
                            <button class="use-btn bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded text-xs" data-index="${index}">
                                使用
                            </button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
            
            // 添加裝備事件
            document.querySelectorAll('.equip-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const index = parseInt(btn.getAttribute('data-index'));
                    const type = btn.getAttribute('data-type');
                    equipItem(index, type);
                });
            });
            
            // 添加使用事件
            document.querySelectorAll('.use-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const index = parseInt(btn.getAttribute('data-index'));
                    useItem(index);
                });
            });
        }
        
        function equipItem(index, type) {
            const item = gameState.player.inventory[index];
            
            if (type === "weapon") {
                // 如果已經有裝備武器，先卸下
                if (gameState.player.equipment.weapon) {
                    gameState.player.attack -= gameState.player.equipment.weapon.attack;
                    gameState.player.inventory.push(gameState.player.equipment.weapon);
                }
                
                // 裝備新武器
                gameState.player.equipment.weapon = item;
                gameState.player.attack += item.attack;
                gameState.player.inventory.splice(index, 1);
                
                addToLog(`你裝備了 ${item.name}。`);
            } else if (type === "armor") {
                // 如果已經有裝備防具，先卸下
                if (gameState.player.equipment.armor) {
                    gameState.player.maxHp -= gameState.player.equipment.armor.hp;
                    // 修正：當卸下防具時，確保當前HP不會超過新的最大HP
                    gameState.player.hp = Math.min(gameState.player.hp, gameState.player.maxHp);
                    gameState.player.inventory.push(gameState.player.equipment.armor);
                }
                
                // 裝備新防具
                gameState.player.equipment.armor = item;
                gameState.player.maxHp += item.hp;
                // 不再增加當前HP，只增加最大HP
                gameState.player.inventory.splice(index, 1);
                
                addToLog(`你裝備了 ${item.name}。`);
            }
            
            updatePlayerStats();
        }
        
        function useItem(index) {
            const item = gameState.player.inventory[index];
            
            if (item.hp) {
                // 使用治療藥水
                const oldHp = gameState.player.hp;
                gameState.player.hp = Math.min(gameState.player.maxHp, gameState.player.hp + item.hp);
                const healAmount = gameState.player.hp - oldHp;
                
                gameState.player.inventory.splice(index, 1);
                
                addToLog(`你使用了 ${item.name}，恢復了 ${healAmount} 點生命值。`);
                updatePlayerStats();
            }
        }
        
        function toggleInventory() {
            const inventory = document.getElementById('inventory');
            inventory.classList.toggle('hidden');
        }
        
        function addToLog(message) {
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry mb-1';
            logEntry.innerHTML = message;
            elements.gameLog.appendChild(logEntry);
            elements.gameLog.scrollTop = elements.gameLog.scrollHeight;
        }
        
        function clearGameLog() {
            elements.gameLog.innerHTML = '<div class="log-entry">日誌已清空。</div>';
        }
        
        // 查看程式碼功能
        function showCodeModal() {
            // 獲取當前頁面的完整程式碼
            const fullCode = document.documentElement.outerHTML;
            
            // 顯示在模態框中
            elements.codeBody.textContent = fullCode;
            elements.codeModal.classList.add('active');
        }
        
        function hideCodeModal() {
            elements.codeModal.classList.remove('active');
        }
        
        // 初始化遊戲
        updatePlayerStats();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'941083eaa4baf1f8',t:'MTc0NzQ1NzY1MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><iframe height="1" width="1" style="position: absolute; top: 0px; left: 0px; border: none; visibility: hidden;"></iframe>

</body></html>